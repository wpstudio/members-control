jQuery(document).ready(function(){function e(e){e=e.toLowerCase().trim().replace(/<.*?>/g,"").replace(/\s/g,"_").replace(/[^a-zA-Z0-9_]/g,""),jQuery(".role-slug").text(e)}jQuery(".memberscontrol-delete-role-link").click(function(){return window.confirm(memberscontrol_i18n.ays_delete_role)}),jQuery('input[name="role_name"]').keyup(function(){jQuery('input[name="role"]').val()||e(this.value)}),jQuery('input[name="role"], .role-ok-button').hide(),jQuery(document).on("click",".role-edit-button.closed",function(){jQuery(this).removeClass("closed").addClass("open").text(memberscontrol_i18n.button_role_ok),jQuery('input[name="role"]').show(),jQuery('input[name="role"]').trigger("focus"),jQuery('input[name="role"]').attr("value",jQuery(".role-slug").text())}),jQuery(document).on("click",".role-edit-button.open",function(){jQuery(this).removeClass("open").addClass("closed").text(memberscontrol_i18n.button_role_edit),jQuery('input[name="role"]').hide();var r=jQuery('input[name="role"]').val();e(r||jQuery('input[name="role_name"]').val())}),jQuery('input[name="role"]').keypress(function(e){if(13===e.keyCode)return jQuery(".role-edit-button").click().trigger("focus"),e.preventDefault(),!1}),jQuery('.users_page_role-new input[name="role_name"]').val()||jQuery(".users_page_role-new #publish").prop("disabled",!0),jQuery('.users_page_role-new input[name="role_name"]').on("input",function(){jQuery(this).val()?jQuery(".users_page_role-new #publish").prop("disabled",!1):jQuery(".users_page_role-new #publish").prop("disabled",!0)});var r=wp.template("memberscontrol-cap-section"),t=wp.template("memberscontrol-cap-control");function n(){var e=jQuery("#memberscontrol-tab-all input[data-grant-cap]:checked").length,r=jQuery("#memberscontrol-tab-all input[data-deny-cap]:checked").length,t=jQuery('#memberscontrol-tab-custom input[name="grant-new-caps[]"]:checked').length,n=jQuery('#memberscontrol-tab-custom input[name="deny-new-caps[]"]:checked').length;jQuery("#submitdiv .granted-count").text(e+t),jQuery("#submitdiv .denied-count").text(r+n)}"undefined"!=typeof memberscontrol_sections&&"undefined"!=typeof memberscontrol_controls&&(_.each(memberscontrol_sections,function(e){jQuery(".memberscontrol-tab-wrap").append(r(e))}),_.each(memberscontrol_controls,function(e){jQuery("#memberscontrol-tab-"+e.section+" tbody").append(t(e))})),jQuery(".memberscontrol-cap-tabs .memberscontrol-tab-content").hide(),jQuery(".memberscontrol-cap-tabs .memberscontrol-tab-content:first-child").show(),jQuery(".memberscontrol-tab-nav :first-child").attr("aria-selected","true"),jQuery(".memberscontrol-which-tab").text(jQuery(".memberscontrol-tab-nav :first-child a").text()),jQuery(".memberscontrol-tab-nav li a").click(function(e){e.preventDefault();var r=jQuery(this).attr("href");jQuery(this).parents(".memberscontrol-cap-tabs").find(".memberscontrol-tab-content").hide(),jQuery(this).parents(".memberscontrol-cap-tabs").find(r).show(),jQuery(this).parents(".memberscontrol-cap-tabs").find(".memberscontrol-tab-title").attr("aria-selected","false"),jQuery(this).parent().attr("aria-selected","true"),jQuery(".memberscontrol-which-tab").text(jQuery(this).text())}),n(),jQuery(document).on("change",".memberscontrol-cap-checklist input[data-grant-cap], .memberscontrol-cap-checklist input[data-deny-cap]",function(){!function(e){var r="grant",t="deny";jQuery(e).attr("data-deny-cap")&&(r="deny",t="grant");var n=jQuery(e).attr("data-"+r+"-cap");jQuery(e).prop("checked")?(jQuery("input[data-"+r+'-cap="'+n+'"]').not(e).prop("checked",!0),jQuery("input[data-"+t+'-cap="'+n+'"]').prop("checked",!1)):jQuery("input[data-"+r+'-cap="'+n+'"]').not(e).prop("checked",!1)}(this),n()}),jQuery(document).on("click",".editable-role .memberscontrol-cap-checklist button",function(){var e=jQuery(this).closest(".memberscontrol-cap-checklist"),r=jQuery(e).find("input[data-grant-cap]"),t=jQuery(e).find("input[data-deny-cap]");jQuery(r).prop("checked")?(jQuery(r).prop("checked",!1),jQuery(t).prop("checked",!0).change()):jQuery(t).prop("checked")?(jQuery(r).prop("checked",!1),jQuery(t).prop("checked",!1).change()):jQuery(r).prop("checked",!0).change()}),jQuery(document).on("hover",".editable-role .memberscontrol-cap-checklist button",function(){jQuery(".memberscontrol-cap-checklist button:focus").not(this).blur()}),postboxes.add_postbox_toggles(pagenow),jQuery("#newcapdiv button.handlediv").attr("type","button"),jQuery("#memberscontrol-add-new-cap").prop("disabled",!0),jQuery("#memberscontrol-new-cap-field").on("input",function(){-1===jQuery.inArray(jQuery(this).val(),memberscontrol_i18n.hidden_caps)?jQuery("#memberscontrol-add-new-cap").prop("disabled",!1):jQuery("#memberscontrol-add-new-cap").prop("disabled",!0)}),jQuery("#memberscontrol-new-cap-field").keypress(function(e){if(13===e.keyCode)return jQuery("#memberscontrol-add-new-cap").click(),e.preventDefault(),!1}),jQuery("#memberscontrol-add-new-cap").click(function(){var e=jQuery("#memberscontrol-new-cap-field").val();if(e=e.trim().replace(/<.*?>/g,"").replace(/\s/g,"_").replace(/[^a-zA-Z0-9_]/g,"")){if(-1!==jQuery.inArray(jQuery(this).val(),memberscontrol_i18n.hidden_caps))return;jQuery('a[href="#memberscontrol-tab-custom"]').trigger("click"),memberscontrol_i18n.label_grant_cap=memberscontrol_i18n.label_grant_cap.replace(/%s/g,"<code>"+e+"</code>"),memberscontrol_i18n.label_deny_cap=memberscontrol_i18n.label_deny_cap.replace(/%s/g,"<code>"+e+"</code>");var r={cap:e,readonly:"",name:{grant:"grant-new-caps[]",deny:"deny-new-caps[]"},is_granted_cap:!0,is_denied_cap:!1,label:{cap:e,grant:memberscontrol_i18n.label_grant_cap,deny:memberscontrol_i18n.label_deny_cap}};jQuery("#memberscontrol-tab-custom tbody").prepend(t(r));var n=jQuery('[data-grant-cap="'+e+'"]').parents(".memberscontrol-cap-checklist");jQuery(n).addClass("memberscontrol-highlight"),setTimeout(function(){jQuery(n).removeClass("memberscontrol-highlight")},500),jQuery("#memberscontrol-new-cap-field").val(""),jQuery("#memberscontrol-add-new-cap").prop("disabled",!0),jQuery('.memberscontrol-cap-checklist input[data-grant-cap="'+e+'"]').trigger("change")}})});